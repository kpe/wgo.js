(function(k,r){var t=document.getElementsByTagName("script"),g={version:"2.3.1",B:1,W:-1,ERROR_REPORT:!0,DIR:t[t.length-1].src.split("?")[0].split("/").slice(0,-1).join("/")+"/",lang:"en",i18n:{en:{}}};g.opera=-1!=navigator.userAgent.search(/(opera)(?:.*version)?[ \/]([\w.]+)/i);g.webkit=-1!=navigator.userAgent.search(/(webkit)[ \/]([\w.]+)/i);g.msie=-1!=navigator.userAgent.search(/(msie) ([\w.]+)/i);g.mozilla=-1!=navigator.userAgent.search(/(mozilla)(?:.*? rv:([\w.]+))?/i)&&!g.webkit&&!g.msie;g.t=
function(a){var c=g.i18n[g.lang][a]||g.i18n.en[a];if(c){for(var h=1;h<arguments.length;h++)c=c.replace("$",arguments[h]);return c}return a};g.extendClass=function(a,c){c.prototype=Object.create(a.prototype);c.prototype.constructor=c;c.prototype.super=a;return c};g.abstractMethod=function(){throw Error("unimplemented abstract method");};g.clone=function(a){if(a&&"object"==typeof a){var c=a.constructor==Array?[]:{},h;for(h in a)c[h]=a[h]==a?a:g.clone(a[h]);return c}return a};g.filterHTML=function(a){return a&&
"string"==typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};var n=function(a,c){c=c||{};for(var h in c)this[h]=c[h];for(h in g.Board.default)this[h]===r&&(this[h]=g.Board.default[h]);for(h in n.themes.default)this.theme[h]===r&&(this.theme[h]=n.themes.default[h]);this.tx=this.section.left;this.ty=this.section.top;this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.init();a.appendChild(this.element);this.pixelRatio=k.devicePixelRatio||1;this.width&&this.height?
this.setDimensions(this.width,this.height):this.width?this.setWidth(this.width):this.height&&this.setHeight(this.height)};n.themes={};n.themes.old={shadowColor:"rgba(32,32,32,0.5)",shadowTransparentColor:"rgba(32,32,32,0)",shadowBlur:0,shadowSize:function(a){return a.shadowSize},markupBlackColor:"rgba(255,255,255,0.8)",markupWhiteColor:"rgba(0,0,0,0.8)",markupNoneColor:"rgba(0,0,0,0.8)",markupLinesWidth:function(a){return a.autoLineWidth?a.stoneRadius/7:a.lineWidth},gridLinesWidth:1,gridLinesColor:function(a){return"rgba(0,0,0,"+
Math.min(1,a.stoneRadius/15)+")"},starColor:"#000",starSize:function(a){return a.starSize*(a.width/300+1)},stoneSize:function(a){return a.stoneSize*Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesColor:"rgba(0,0,0,0.7)",font:function(a){return a.font},linesShift:.5};n.themes.default={shadowColor:"rgba(62,32,32,0.5)",shadowTransparentColor:"rgba(62,32,32,0)",shadowBlur:function(a){return.1*a.stoneRadius},shadowSize:1,markupBlackColor:"rgba(255,255,255,0.9)",markupWhiteColor:"rgba(0,0,0,0.7)",markupNoneColor:"rgba(0,0,0,0.7)",
markupLinesWidth:function(a){return a.stoneRadius/8},gridLinesWidth:function(a){return a.stoneRadius/15},gridLinesColor:"#654525",starColor:"#531",starSize:function(a){return a.stoneRadius/8+1},stoneSize:function(a){return Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesColor:"#531",font:"calibri",linesShift:.25};var q=function(a,c){return"function"==typeof c.theme[a]?c.theme[a](c):c.theme[a]},t={draw:function(a,c){var h=c.getX(a.x),x=c.getY(a.y),e=c.stoneRadius;this.beginPath();var d=q("shadowBlur",
c),e=Math.max(0,e-.5),b=this.createRadialGradient(h-c.ls,x-c.ls,e-1-d,h-c.ls,x-c.ls,e+d);b.addColorStop(0,q("shadowColor",c));b.addColorStop(1,q("shadowTransparentColor",c));this.fillStyle=b;this.arc(h-c.ls,x-c.ls,e+d,0,2*Math.PI,!0);this.fill()},clear:function(a,c){var h=c.getX(a.x),x=c.getY(a.y),e=c.stoneRadius;this.clearRect(h-1.1*e-c.ls,x-1.1*e-c.ls,2.2*e,2.2*e)}},u=function(a,c,h){return a.obj_arr[c][h][0].c==g.B?q("markupBlackColor",a):a.obj_arr[c][h][0].c==g.W?q("markupWhiteColor",a):q("markupNoneColor",
a)},y=function(a,c,h){return a.obj_arr[c][h][0]&&a.obj_arr[c][h][0].c==g.W||a.obj_arr[c][h][0].c==g.B},A,v=function(a){for(var c=a.angle,h=a.angle,x=0;x<a.lines.length;x++){var c=c+a.lines[x],h=h-a.lines[x],e=a.ctx,d=a.x,b=a.y,l=a.radius,f=c,g=h,z=a.factor,k=a.thickness;e.strokeStyle="rgba(64,64,64,0.2)";e.lineWidth=l/30*k;e.beginPath();var l=l-Math.max(1,e.lineWidth),k=d+l*Math.cos(f*Math.PI),f=b+l*Math.sin(f*Math.PI),d=d+l*Math.cos(g*Math.PI),b=b+l*Math.sin(g*Math.PI),m=g=void 0,m=g=void 0;d>k?
(g=(b-f)/(d-k),m=Math.atan(g)):d==k?m=Math.PI/2:(g=(b-f)/(d-k),m=Math.atan(g)-Math.PI);l*=z;g=Math.sin(m)*l;m=Math.cos(m)*l;l=k+g;z=f-m;g=d+g;m=b-m;e.moveTo(k,f);e.bezierCurveTo(l,z,g,m,d,b);e.stroke()}};n.drawHandlers={NORMAL:{stone:{draw:function(a,c){var h=c.getX(a.x),x=c.getY(a.y),e=c.stoneRadius,d;a.c==g.W?(d=this.createRadialGradient(h-2*e/5,x-2*e/5,e/3,h-e/5,x-e/5,5*e/5),d.addColorStop(0,"#fff"),d.addColorStop(1,"#aaa")):(d=this.createRadialGradient(h-2*e/5,x-2*e/5,1,h-e/5,x-e/5,4*e/5),d.addColorStop(0,
"#666"),d.addColorStop(1,"#000"));this.beginPath();this.fillStyle=d;this.arc(h-c.ls,x-c.ls,Math.max(0,e-.5),0,2*Math.PI,!0);this.fill()}},shadow:t},PAINTED:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius,b;a.c==g.W?(b=this.createRadialGradient(h-2*e/5,d-2*e/5,2,h-e/5,d-e/5,4*e/5),b.addColorStop(0,"#fff"),b.addColorStop(1,"#ddd")):(b=this.createRadialGradient(h-2*e/5,d-2*e/5,1,h-e/5,d-e/5,4*e/5),b.addColorStop(0,"#111"),b.addColorStop(1,"#000"));this.beginPath();this.fillStyle=
b;this.arc(h-c.ls,d-c.ls,Math.max(0,e-.5),0,2*Math.PI,!0);this.fill();this.beginPath();this.lineWidth=e/6;a.c==g.W?(this.strokeStyle="#999",this.arc(h+e/8,d+e/8,e/2,0,Math.PI/2,!1)):(this.strokeStyle="#ccc",this.arc(h-e/8,d-e/8,e/2,Math.PI,1.5*Math.PI));this.stroke()}},shadow:t},GLOW:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius,b;a.c==g.W?(b=this.createRadialGradient(h-2*e/5,d-2*e/5,e/3,h-e/5,d-e/5,8*e/5),b.addColorStop(0,"#fff"),b.addColorStop(1,"#666")):(b=this.createRadialGradient(h-
2*e/5,d-2*e/5,1,h-e/5,d-e/5,3*e/5),b.addColorStop(0,"#555"),b.addColorStop(1,"#000"));this.beginPath();this.fillStyle=b;this.arc(h-c.ls,d-c.ls,Math.max(0,e-.5),0,2*Math.PI,!0);this.fill()}},shadow:t},SHELL:{stone:{draw:function(a,c){var h,d,e=c.stoneRadius;A=A||Math.ceil(9999999*Math.random());h=c.getX(a.x);d=c.getY(a.y);var b;b=a.c==g.W?"#aaa":"#000";this.beginPath();this.fillStyle=b;this.arc(h-c.ls,d-c.ls,Math.max(0,e-.5),0,2*Math.PI,!0);this.fill();if(a.c==g.W){b=A%(3+a.x*c.size+a.y)%3;var l=c.size*
c.size+a.x*c.size+a.y,l=2/l*(A%l);0==b?v({ctx:this,x:h,y:d,radius:e,angle:l,lines:[.1,.12,.11,.1,.09,.09,.09,.09],factor:.25,thickness:1.75}):1==b?v({ctx:this,x:h,y:d,radius:e,angle:l,lines:[.1,.09,.08,.07,.06,.06,.06,.06,.06,.06,.06],factor:.2,thickness:1.5}):v({ctx:this,x:h,y:d,radius:e,angle:l,lines:[.12,.14,.13,.12,.12,.12],factor:.3,thickness:2});b=this.createRadialGradient(h-2*e/5,d-2*e/5,e/3,h-e/5,d-e/5,5*e/5);b.addColorStop(0,"rgba(255,255,255,0.9)");b.addColorStop(1,"rgba(255,255,255,0)")}else b=
this.createRadialGradient(h+.4*e,d+.4*e,0,h+.5*e,d+.5*e,e),b.addColorStop(0,"rgba(32,32,32,1)"),b.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=b,this.arc(h-c.ls,d-c.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),b=this.createRadialGradient(h-.4*e,d-.4*e,1,h-.5*e,d-.5*e,1.5*e),b.addColorStop(0,"rgba(64,64,64,1)"),b.addColorStop(1,"rgba(0,0,0,0)");this.beginPath();this.fillStyle=b;this.arc(h-c.ls,d-c.ls,Math.max(0,e-.5),0,2*Math.PI,!0);this.fill()}},shadow:t},MONO:{stone:{draw:function(a,
c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius,b=q("markupLinesWidth",c)||1;this.fillStyle=a.c==g.W?"white":"black";this.beginPath();this.arc(h,d,Math.max(0,e-b),0,2*Math.PI,!0);this.fill();this.lineWidth=b;this.strokeStyle="black";this.stroke()}}},CR:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius;this.strokeStyle=a.c||u(c,a.x,a.y);this.lineWidth=a.lineWidth||q("markupLinesWidth",c)||1;this.beginPath();this.arc(h-c.ls,d-c.ls,e/2,0,2*Math.PI,!0);this.stroke()}}},LB:{stone:{draw:function(a,
c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius,b=a.font||q("font",c)||"";this.fillStyle=a.c||u(c,a.x,a.y);this.font=1==a.text.length?Math.round(1.5*e)+"px "+b:2==a.text.length?Math.round(1.2*e)+"px "+b:Math.round(e)+"px "+b;this.beginPath();this.textBaseline="middle";this.textAlign="center";this.fillText(a.text,h,d,2*e)}},grid:{draw:function(a,c){if(!y(c,a.x,a.y)&&!a._nodraw){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius;this.clearRect(h-e,d-e,2*e,2*e)}},clear:function(a,c){if(!y(c,a.x,a.y)){a._nodraw=
!0;var h;c.grid.clear();c.grid.draw(c);for(var d=0;d<c.size;d++)for(var e=0;e<c.size;e++)for(var b in c.obj_arr[d][e])h=c.obj_arr[d][e][b].type?"string"==typeof c.obj_arr[d][e][b].type?n.drawHandlers[c.obj_arr[d][e][b].type]:c.obj_arr[d][e][b].type:c.stoneHandler,h.grid&&h.grid.draw.call(c.grid.getContext(c.obj_arr[d][e][b]),c.obj_arr[d][e][b],c);for(b in c.obj_list)h=c.obj_list[b].handler,h.grid&&h.grid.draw.call(c.grid.getContext(c.obj_list[b].args),c.obj_list[b].args,c);delete a._nodraw}}}},SQ:{stone:{draw:function(a,
c){var h=c.getX(a.x),d=c.getY(a.y),e=Math.round(c.stoneRadius);this.strokeStyle=a.c||u(c,a.x,a.y);this.lineWidth=a.lineWidth||q("markupLinesWidth",c)||1;this.beginPath();this.rect(Math.round(h-e/2)-c.ls,Math.round(d-e/2)-c.ls,e,e);this.stroke()}}},TR:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius;this.strokeStyle=a.c||u(c,a.x,a.y);this.lineWidth=a.lineWidth||q("markupLinesWidth",c)||1;this.beginPath();this.moveTo(h-c.ls,d-c.ls-Math.round(e/2));this.lineTo(Math.round(h-
e/2)-c.ls,Math.round(d+e/3)+c.ls);this.lineTo(Math.round(h+e/2)+c.ls,Math.round(d+e/3)+c.ls);this.closePath();this.stroke()}}},MA:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius;this.strokeStyle=a.c||u(c,a.x,a.y);this.lineCap="round";this.lineWidth=2*(a.lineWidth||q("markupLinesWidth",c)||1)-1;this.beginPath();this.moveTo(Math.round(h-e/2),Math.round(d-e/2));this.lineTo(Math.round(h+e/2),Math.round(d+e/2));this.moveTo(Math.round(h+e/2)-1,Math.round(d-e/2));this.lineTo(Math.round(h-
e/2)-1,Math.round(d+e/2));this.stroke();this.lineCap="butt"}}},SL:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius;this.fillStyle=a.c||u(c,a.x,a.y);this.beginPath();this.rect(h-e/2,d-e/2,e,e);this.fill()}}},SM:{stone:{draw:function(a,c){var h=c.getX(a.x),d=c.getY(a.y),e=c.stoneRadius;this.strokeStyle=a.c||u(c,a.x,a.y);this.lineWidth=2*(a.lineWidth||q("markupLinesWidth",c)||1);this.beginPath();this.arc(h-e/3,d-e/3,e/6,0,2*Math.PI,!0);this.stroke();this.beginPath();this.arc(h+
e/3,d-e/3,e/6,0,2*Math.PI,!0);this.stroke();this.beginPath();this.moveTo(h-e/1.5,d);this.bezierCurveTo(h-e/1.5,d+e/2,h+e/1.5,d+e/2,h+e/1.5,d);this.stroke()}}},outline:{stone:{draw:function(a,c){this.globalAlpha=a.alpha?a.alpha:.3;a.stoneStyle?n.drawHandlers[a.stoneStyle].stone.draw.call(this,a,c):c.stoneHandler.stone.draw.call(this,a,c);this.globalAlpha=1}}},mini:{stone:{draw:function(a,c){c.stoneRadius/=2;a.stoneStyle?n.drawHandlers[a.stoneStyle].stone.draw.call(this,a,c):c.stoneHandler.stone.draw.call(this,
a,c);c.stoneRadius*=2}}}};n.coordinates={grid:{draw:function(a,c){var d,b,e,l,g,f;this.fillStyle=q("coordinatesColor",c);this.textBaseline="middle";this.textAlign="center";this.font=c.stoneRadius+"px "+(c.font||"");e=c.getX(-.75);l=c.getX(c.size-.25);g=c.getY(-.75);f=c.getY(c.size-.25);for(var k=0;k<c.size;k++)d=k+65,73<=d&&d++,b=c.getY(k),this.fillText(c.size-k,e,b),this.fillText(c.size-k,l,b),b=c.getX(k),this.fillText(String.fromCharCode(d),b,g),this.fillText(String.fromCharCode(d),b,f);this.fillStyle=
"black"}}};n.CanvasLayer=function(){this.element=document.createElement("canvas");this.context=this.element.getContext("2d");this.pixelRatio=k.devicePixelRatio||1;1<this.pixelRatio&&this.context.scale(this.pixelRatio,this.pixelRatio)};n.CanvasLayer.prototype={constructor:n.CanvasLayer,setDimensions:function(a,c){this.element.width=a;this.element.style.width=a/this.pixelRatio+"px";this.element.height=c;this.element.style.height=c/this.pixelRatio+"px"},appendTo:function(a,c){this.element.style.position=
"absolute";this.element.style.zIndex=c;a.appendChild(this.element)},removeFrom:function(a){a.removeChild(this.element)},getContext:function(){return this.context},draw:function(a){},clear:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}};n.GridLayer=g.extendClass(n.CanvasLayer,function(){this.super.call(this)});n.GridLayer.prototype.draw=function(a){var c;this.context.beginPath();this.context.lineWidth=q("gridLinesWidth",a);this.context.strokeStyle=q("gridLinesColor",
a);var d=Math.round(a.left),b=Math.round(a.top),e=Math.round(a.fieldWidth*(a.size-1)),l=Math.round(a.fieldHeight*(a.size-1));this.context.strokeRect(d-a.ls,b-a.ls,e,l);for(var g=1;g<a.size-1;g++)c=Math.round(a.getX(g))-a.ls,this.context.moveTo(c,b),this.context.lineTo(c,b+l),c=Math.round(a.getY(g))-a.ls,this.context.moveTo(d,c),this.context.lineTo(d+e,c);this.context.stroke();this.context.fillStyle=q("starColor",a);if(a.starPoints[a.size])for(var f in a.starPoints[a.size])this.context.beginPath(),
this.context.arc(a.getX(a.starPoints[a.size][f].x)-a.ls,a.getY(a.starPoints[a.size][f].y)-a.ls,q("starSize",a),0,2*Math.PI,!0),this.context.fill()};n.MultipleCanvasLayer=g.extendClass(n.CanvasLayer,function(){this.init(4)});n.MultipleCanvasLayer.prototype.init=function(a){var c,d;this.layers=a;this.elements=[];this.contexts=[];this.pixelRatio=k.devicePixelRatio||1;for(var b=0;b<a;b++)c=document.createElement("canvas"),d=c.getContext("2d"),1<this.pixelRatio&&d.scale(this.pixelRatio,this.pixelRatio),
this.elements.push(c),this.contexts.push(d)};n.MultipleCanvasLayer.prototype.appendTo=function(a,c){for(var d=0;d<this.layers;d++)this.elements[d].style.position="absolute",this.elements[d].style.zIndex=c,a.appendChild(this.elements[d])};n.MultipleCanvasLayer.prototype.removeFrom=function(a){for(var c=0;c<this.layers;c++)a.removeChild(this.elements[c])};n.MultipleCanvasLayer.prototype.getContext=function(a){return a.x%2?a.y%2?this.contexts[0]:this.contexts[1]:a.y%2?this.contexts[2]:this.contexts[3]};
n.MultipleCanvasLayer.prototype.clear=function(a,c){for(var d=0;d<this.layers;d++)this.contexts[d].clearRect(0,0,this.elements[d].width,this.elements[d].height)};n.MultipleCanvasLayer.prototype.setDimensions=function(a,c){for(var d=0;d<this.layers;d++)this.elements[d].width=a,this.elements[d].style.width=a/this.pixelRatio+"px",this.elements[d].height=c,this.elements[d].style.height=c/this.pixelRatio+"px"};n.ShadowLayer=g.extendClass(n.MultipleCanvasLayer,function(a,c,d){this.init(2);this.shadowSize=
c===r?1:c;this.board=a});n.ShadowLayer.prototype.getContext=function(a){return a.x%2&&a.y%2||!(a.x%2||a.y%2)?this.contexts[0]:this.contexts[1]};n.ShadowLayer.prototype.setDimensions=function(a,c){this.super.prototype.setDimensions.call(this,a,c);for(var d=0;d<this.layers;d++)this.contexts[d].setTransform(1,0,0,1,Math.round(this.shadowSize*this.board.stoneRadius/7),Math.round(this.shadowSize*this.board.stoneRadius/7))};var m=function(a,c){var d=c.getX(a.x),b=c.getY(a.y),e=c.stoneRadius;this.clearRect(d-
2*e-c.ls,b-2*e-c.ls,4*e,4*e)},p=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx},b=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty},f=function(a,c){var d,b;for(b in this.obj_arr[a][c]){d=this.obj_arr[a][c][b].type?"string"==typeof this.obj_arr[a][c][b].type?n.drawHandlers[this.obj_arr[a][c][b].type]:this.obj_arr[a][c][b].type:this.stoneHandler;for(var e in d)d[e].clear?d[e].clear.call(this[e].getContext(this.obj_arr[a][c][b]),this.obj_arr[a][c][b],
this):m.call(this[e].getContext(this.obj_arr[a][c][b]),this.obj_arr[a][c][b],this)}},s=function(a,c){var d,b;for(b in this.obj_arr[a][c]){d=this.obj_arr[a][c][b].type?"string"==typeof this.obj_arr[a][c][b].type?n.drawHandlers[this.obj_arr[a][c][b].type]:this.obj_arr[a][c][b].type:this.stoneHandler;for(var e in d)d[e].draw.call(this[e].getContext(this.obj_arr[a][c][b]),this.obj_arr[a][c][b],this)}},C=function(a){for(var c=0,d=0,b=this.grid.element;b&&"BODY"!=b.tagName;)c+=b.offsetTop,d+=b.offsetLeft,
b=b.offsetParent;b=a.pageX*this.pixelRatio;b-=d*this.pixelRatio;b-=this.left;b/=this.fieldWidth;b=Math.round(b);a=a.pageY*this.pixelRatio;a-=c*this.pixelRatio;a-=this.top;a/=this.fieldHeight;a=Math.round(a);return{x:b>=this.size?-1:b,y:a>=this.size?-1:a}},B=function(){this.element.style.width=this.width/this.pixelRatio+"px";this.element.style.height=this.height/this.pixelRatio+"px";this.stoneRadius=q("stoneSize",this);this.ls=q("linesShift",this);for(var a in this.layers)this.layers[a].setDimensions(this.width,
this.height)};n.prototype={constructor:n,init:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var c=0;c<this.size;c++)this.obj_arr[a][c]=[]}this.obj_list=[];this.layers=[];this.listeners=[];this.element=document.createElement("div");this.element.className="wgo-board";this.background&&("#"==this.background[0]?this.element.style.backgroundColor=this.background:this.element.style.backgroundImage="url('"+this.background+"')");this.grid=new n.GridLayer;this.shadow=new n.ShadowLayer(this,
q("shadowSize",this));this.stone=new n.MultipleCanvasLayer;this.addLayer(this.grid,100);this.addLayer(this.shadow,200);this.addLayer(this.stone,300)},setWidth:function(a){this.width=a;this.width*=this.pixelRatio;this.fieldHeight=this.fieldWidth=4*this.width/(4*(this.bx+1-this.tx)+2);this.left=p.call(this);this.height=(this.by-this.ty+1.5)*this.fieldHeight;this.top=b.call(this);B.call(this);this.redraw()},setHeight:function(a){this.height=a;this.height*=this.pixelRatio;this.fieldWidth=this.fieldHeight=
4*this.height/(4*(this.by+1-this.ty)+2);this.top=b.call(this);this.width=(this.bx-this.tx+1.5)*this.fieldWidth;this.left=p.call(this);B.call(this);this.redraw()},setDimensions:function(a,c){this.width=a||parseInt(this.element.style.width,10);this.width*=this.pixelRatio;this.height=c||parseInt(this.element.style.height,10);this.height*=this.pixelRatio;this.fieldWidth=4*this.width/(4*(this.bx+1-this.tx)+2);this.fieldHeight=4*this.height/(4*(this.by+1-this.ty)+2);this.left=p.call(this);this.top=b.call(this);
B.call(this);this.redraw()},getSection:function(){return this.section},setSection:function(a,c,d,b){this.section="object"==typeof a?a:{top:a,right:c,bottom:d,left:b};this.tx=this.section.left;this.ty=this.section.top;this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.setDimensions()},setSize:function(a){a=a||19;if(a!=this.size){this.size=a;this.obj_arr=[];for(a=0;a<this.size;a++){this.obj_arr[a]=[];for(var c=0;c<this.size;c++)this.obj_arr[a][c]=[]}this.bx=this.size-
1-this.section.right;this.by=this.size-1-this.section.bottom;this.setDimensions()}},redraw:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].clear(this),this.layers[a].draw(this);for(a=0;a<this.size;a++)for(var c=0;c<this.size;c++)s.call(this,a,c);for(var d in this.obj_list){var a=this.obj_list[d].handler,b;for(b in a)a[b].draw.call(this[b].getContext(this.obj_list[d].args),this.obj_list[d].args,this)}},getX:function(a){return this.left+a*this.fieldWidth},getY:function(a){return this.top+
a*this.fieldHeight},addLayer:function(a,c){a.appendTo(this.element,c);a.setDimensions(this.width,this.height);this.layers.push(a)},removeLayer:function(a){var c=this.layers.indexOf(a);0<=c&&(this.layers.splice(c,1),a.removeFrom(this.element))},update:function(a){if(a.remove&&"all"==a.remove)this.removeAllObjects();else if(a.remove)for(var c in a.remove)this.removeObject(a.remove[c]);if(a.add)for(c in a.add)this.addObject(a.add[c])},addObject:function(a){if(a.constructor==Array)for(var c in a)this.addObject(a[c]);
else{f.call(this,a.x,a.y);for(c in this.obj_arr[a.x][a.y])if(this.obj_arr[a.x][a.y][c].type==a.type){this.obj_arr[a.x][a.y][c]=a;s.call(this,a.x,a.y);return}a.type?this.obj_arr[a.x][a.y].push(a):this.obj_arr[a.x][a.y].unshift(a);s.call(this,a.x,a.y)}},removeObject:function(a){if(a.constructor==Array)for(var c in a)this.removeObject(a[c]);else{var d;for(c=0;c<this.obj_arr[a.x][a.y].length;c++)if(this.obj_arr[a.x][a.y][c].type==a.type){d=c;break}d!==r&&(f.call(this,a.x,a.y),this.obj_arr[a.x][a.y].splice(d,
1),s.call(this,a.x,a.y))}},removeObjectsAt:function(a,c){this.obj_arr[a][c].length&&(f.call(this,a,c),this.obj_arr[a][c]=[])},removeAllObjects:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var c=0;c<this.size;c++)this.obj_arr[a][c]=[]}this.redraw()},addCustomObject:function(a,c){this.obj_list.push({handler:a,args:c});this.redraw()},removeCustomObject:function(a,c){for(var d in this.obj_list)if(this.obj_list[d].handler==a&&this.obj_list[d].args==c)return delete this.obj_list[d],
this.redraw(),!0;return!1},addEventListener:function(a,c){var d=this,b={type:a,callback:c,handleEvent:function(a){var b=C.call(d,a);c(b.x,b.y,a)}};this.element.addEventListener(a,b,!0);this.listeners.push(b)},removeEventListener:function(a,c){for(var d in this.listeners)if(this.listeners[d].type==a&&this.listeners[d].callback==c)return this.element.removeEventListener(this.listeners[d].type,this.listeners[d],!0),delete this.listeners[d],!0;return!1},getState:function(){return{objects:g.clone(this.obj_arr),
custom:g.clone(this.obj_list)}},restoreState:function(a){this.obj_arr=a.objects||this.obj_arr;this.obj_list=a.custom||this.obj_list;this.redraw()}};n.default={size:19,width:0,height:0,font:"Calibri",lineWidth:1,autoLineWidth:!1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:n.drawHandlers.SHELL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,
left:0},background:g.DIR+"wood1.jpg",theme:{}};g.Board=n;var w=function(a){this.size=a||19;this.schema=[];for(a=0;a<this.size*this.size;a++)this.schema[a]=0};w.prototype={constructor:g.Position,get:function(a,c){return 0>a||0>c||a>=this.size||c>=this.size?r:this.schema[a*this.size+c]},set:function(a,c,d){this.schema[a*this.size+c]=d;return this},clear:function(){for(var a=0;a<this.size*this.size;a++)this.schema[a]=0;return this},clone:function(){var a=new w(this.size);a.schema=this.schema.slice(0);
return a},compare:function(a){for(var c=[],d=[],b=0;b<this.size*this.size;b++)this.schema[b]&&!a.schema[b]?d.push({x:Math.floor(b/this.size),y:b%this.size}):this.schema[b]!=a.schema[b]&&c.push({x:Math.floor(b/this.size),y:b%this.size,c:a.schema[b]});return{add:c,remove:d}}};g.Position=w;var t=function(a,c,d,b){this.size=a||19;this.repeating=c===r?"KO":c;this.allow_rewrite=d||!1;this.allow_suicide=b||!1;this.stack=[];this.stack[0]=new w(this.size);this.stack[0].capCount={black:0,white:0};this.turn=
g.B;Object.defineProperty(this,"position",{get:function(){return this.stack[this.stack.length-1]},set:function(a){this[this.stack.length-1]=a}})},d=function(a,c,b,l,e){0<=b&&b<a.size&&0<=l&&l<a.size&&a.get(b,l)==e&&(a.set(b,l,0),c.push({x:b,y:l}),d(a,c,b,l-1,e),d(a,c,b,l+1,e),d(a,c,b-1,l,e),d(a,c,b+1,l,e))},l=function(a,c,d,b,e){if(0>d||d>=a.size||0>b||b>=a.size)return!0;if(0==a.get(d,b))return!1;if(!0==c.get(d,b)||a.get(d,b)==-e)return!0;c.set(d,b,!0);return l(a,c,d,b-1,e)&&l(a,c,d,b+1,e)&&l(a,c,
d-1,b,e)&&l(a,c,d+1,b,e)},z=function(a,c,b,g){var e=[];if(0<=c&&c<a.size&&0<=b&&b<a.size&&a.get(c,b)==g){var f=new w(a.size);l(a,f,c,b,g)&&d(a,e,c,b,g)}return e};t.prototype={constructor:t,getPosition:function(){return this.stack[this.stack.length-1]},play:function(a,c,b,f){if(!this.isOnBoard(a,c))return 1;if(!this.allow_rewrite&&0!=this.position.get(a,c))return 2;b||(b=this.turn);var e=this.position.clone();e.set(a,c,b);var k=b,m=z(e,a-1,c,-b).concat(z(e,a+1,c,-b),z(e,a,c-1,-b),z(e,a,c+1,-b));if(!m.length){var s=
new w(this.size);if(l(e,s,a,c,b))if(this.allow_suicide)k=-b,d(e,m,a,c,b);else return 3}if(s=this.repeating){a:{var n;if("KO"==this.repeating&&0<=this.stack.length-2)n=this.stack.length-2;else if("ALL"==this.repeating)n=0;else{a=!0;break a}for(var v=this.stack.length-2;v>=n;v--)if(this.stack[v].get(a,c)==e.get(a,c)){for(var s=!0,p=0;p<this.size*this.size;p++)if(this.stack[v].schema[p]!=e.schema[p]){s=!1;break}if(s){a=!1;break a}}a=!0}s=!a}if(s)return 4;if(f)return!1;e.color=b;e.capCount={black:this.position.capCount.black,
white:this.position.capCount.white};k==g.B?e.capCount.black+=m.length:e.capCount.white+=m.length;this.pushPosition(e);this.turn=-b;return m},pass:function(a){this.pushPosition();a?(this.position.color=a,this.turn=-a):(this.position.color=this.turn,this.turn=-this.turn)},isValid:function(a,c,d){return"number"!=typeof this.play(a,c,d,!0)},isOnBoard:function(a,c){return 0<=a&&0<=c&&a<this.size&&c<this.size},addStone:function(a,c,d){return this.isOnBoard(a,c)&&0==this.position.get(a,c)?(this.position.set(a,
c,d||0),!0):!1},removeStone:function(a,c){return this.isOnBoard(a,c)&&0!=this.position.get(a,c)?(this.position.set(a,c,0),!0):!1},setStone:function(a,c,d){return this.isOnBoard(a,c)?(this.position.set(a,c,d||0),!0):!1},getStone:function(a,c){return this.isOnBoard(a,c)?this.position.get(a,c):0},pushPosition:function(a){a||(a=this.position.clone(),a.capCount={black:this.position.capCount.black,white:this.position.capCount.white},a.color=this.position.color);this.stack.push(a);a.color&&(this.turn=-a.color);
return this},popPosition:function(){var a=null;0<this.stack.length&&(a=this.stack.pop(),this.turn=0==this.stack.length?g.B:this.position.color?-this.position.color:-this.turn);return a},firstPosition:function(){this.stack=[];this.stack[0]=new w(this.size);this.stack[0].capCount={black:0,white:0};this.turn=g.B;return this},getCaptureCount:function(a){return a==g.B?this.position.capCount.black:this.position.capCount.white},validatePosition:function(){for(var a,c,d=0,b=0,e=[],l=this.position.clone(),
f=0;f<this.size;f++)for(var k=0;k<this.size;k++)if(a=this.position.get(f,k))c=e.length,e=e.concat(z(l,f-1,k,-a),z(l,f+1,k,-a),z(l,f,k-1,-a),z(l,f,k+1,-a)),a==g.B?b+=e-c:d+=e-c;this.position.capCount.black+=b;this.position.capCount.white+=d;this.position.schema=l.schema;return e}};g.Game=t;k.WGo=g})(window);(function(k,r){var t=function(d){var b=new m(JSON.parse(JSON.stringify(d.getProperties()))),f;for(f in d.children)b.appendChild(t(d.children[f]));return b},g=function(d,b){var f;if(b[d]!==r)return b[d];for(var a in b.children)if(f=g(d,b.children[a]))return f;return!1},n=function(d,b){d.push(JSON.parse(JSON.stringify(b.getProperties())));if(1<b.children.length){for(var f=[],a=0;a<b.children.length;a++){var c=[];n(c,b.children[a]);f.push(c)}d.push(f)}else b.children.length&&n(d,b.children[0])},q=function(d,
b){for(var f=b,a,c=1;c<d.length;c++)if(d[c].constructor==Array)for(var h=0;h<d[c].length;h++)a=new m(d[c][h][0]),f.appendChild(a),q(d[c][h],a);else a=new m(d[c]),f.insertAfter(a),f=a},u=function(){this.size=19;this.info={};this.root=new m;this.propertyCount=this.nodeCount=0};u.prototype={constructor:u,clone:function(){var d=new u;d.size=this.size;d.info=JSON.parse(JSON.stringify(this.info));d.root=t(this.root);d.nodeCount=this.nodeCount;d.propertyCount=this.propertyCount;return d},hasComments:function(){return!!g("comment",
this.root)}};u.fromSgf=function(d){return k.SGF.parse(d)};u.fromJGO=function(d){d="string"==typeof d?JSON.parse(d):d;var b=new u;b.info=JSON.parse(JSON.stringify(d.info));b.size=d.size;b.nodeCount=d.nodeCount;b.propertyCount=d.propertyCount;b.root=new m(d.game[0]);q(d.game,b.root);return b};u.prototype.toSgf=function(){};u.prototype.toJGO=function(d){var b={};b.size=this.size;b.info=JSON.parse(JSON.stringify(this.info));b.nodeCount=this.nodeCount;b.propertyCount=this.propertyCount;b.game=[];n(b.game,
this.root);return d?JSON.stringify(b):b};var y=function(b){var l;b.name?(l=k.filterHTML(b.name),b.rank&&(l+=" ("+k.filterHTML(b.rank)+")"),b.team&&(l+=", "+k.filterHTML(b.team))):(b.team&&(l=k.filterHTML(b.team)),b.rank&&(l+=" ("+k.filterHTML(b.rank)+")"));return l};u.infoFormatters={black:y,white:y,TM:function(b){if(0==b)return k.t("none");var l,f=Math.floor(b/60);1==f?l="1 "+k.t("minute"):1<f&&(l=f+" "+k.t("minutes"));f=b%60;1==f?l+=" 1 "+k.t("second"):1<f&&(l+=" "+f+" "+k.t("seconds"));return l},
RE:function(b){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+k.filterHTML(b)+'\'" title="'+k.t("res-show-tip")+'">'+k.t("show")+"</a>"}};u.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");k.Kifu=u;var A=function(b,l,f){for(var a=0;a<b.length;a++)if(b[a].x==l.x&&b[a].y==l.y){b[a][f]=l[f];return}b.push(l)},v=function(b,l){if(b)for(var f=0;f<b.length;f++)if(b[f].x==l.x&&b[f].y==l.y){b.splice(f,1);break}},m=function(b,l){this.parent=
l||null;this.children=[];if(b)for(var f in b)this[f]=b[f]};m.prototype={constructor:m,getChild:function(b){b=b||0;return this.children[b]?this.children[b]:null},addSetup:function(b){this.setup=this.setup||[];A(this.setup,b,"c");return this},removeSetup:function(b){v(this.setup,b);return this},addMarkup:function(b){this.markup=this.markup||[];A(this.markup,b,"type");return this},removeMarkup:function(b){v(this.markup,b);return this},remove:function(){var b=this.parent;if(!b)throw new Exception("Root node cannot be removed");
for(var l in b.children)if(b.children[l]==this){b.children.splice(l,1);break}b.children=b.children.concat(this.children);this.parent=null;return b},insertAfter:function(b){for(var l in this.children)this.children[l].parent=b;b.children=b.children.concat(this.children);b.parent=this;this.children=[b];return b},appendChild:function(b){b.parent=this;this.children.push(b);return b},getProperties:function(){var b={},l;for(l in this)this.hasOwnProperty(l)&&"children"!=l&&"parent"!=l&&(b[l]=this[l]);return b}};
k.KNode=m;var p=function(b,l){for(var f=b.size,a=[],c=[],h=0;h<f*f;h++)b.schema[h]&&!l.schema[h]?c.push({x:Math.floor(h/f),y:h%f}):b.schema[h]!=l.schema[h]&&a.push({x:Math.floor(h/f),y:h%f,c:l.schema[h]});return{add:a,remove:c}},y=function(b,l,g){this.kifu=b;this.node=this.kifu.root;this.allow_illegal=g||!1;this.game=new k.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=k.W);this.change=
f(this.game,this.node,!0);this.rememberPath=l?!0:!1},b=function(b,l){var f=[],a,c;for(c in b){a=!0;for(var h in l)if(b[c].x==l[h].x&&b[c].y==l[h].y){a=!1;break}a&&f.push(b[c])}return f},f=function(b,f,g){f.parent&&(f.parent._last_selected=f.parent.children.indexOf(f));if(f.move!=r){if(f.move.pass)return b.pass(f.move.c),{add:[],remove:[]};b=b.play(f.move.x,f.move.y,f.move.c);if("number"==typeof b)throw new w(b,f);for(var a in b)if(b[a].x==f.move.x&&b[a].y==f.move.y)return{add:[],remove:b};return{add:[f.move],
remove:b}}g||b.pushPosition();g=[];var c=[];if(f.setup!=r)for(a in f.setup)f.setup[a].c?(b.setStone(f.setup[a].x,f.setup[a].y,f.setup[a].c),g.push(f.setup[a])):(b.removeStone(f.setup[a].x,f.setup[a].y),c.push(f.setup[a]));f.turn&&(b.turn=f.turn);return{add:g,remove:c}},s=function(b){b===r&&this.rememberPath&&(b=this.node._last_selected);b=b||0;var l=this.node.children[b];if(!l)return!1;var g=f(this.game,l);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=b);this.node=l;return g},
C=function(){if(!this.node.parent)return!1;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==r&&delete this.path[this.path.m];this.path.m--;return!0},B=function(){this.game.firstPosition();this.node=this.kifu.root;this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=k.W);this.change=f(this.game,this.node,!0)};y.prototype={constructor:y,next:function(b){this.change=s.call(this,b);return this},last:function(){var d;
for(this.change={add:[],remove:[]};d=s.call(this);){var f=this.change;f.add=b(f.add,d.remove).concat(d.add);f.remove=b(f.remove,d.add).concat(d.remove)}return this},previous:function(){var b=this.game.getPosition();C.call(this);this.change=p(b,this.game.getPosition());return this},first:function(){var b=this.game.getPosition();B.call(this);this.change=p(b,this.game.getPosition());return this},goTo:function(b){if(b===r)return this;var f=this.game.getPosition();B.call(this);for(var g=0;g<b.m&&s.call(this,
b[g+1]);g++);this.change=p(f,this.game.getPosition());return this},previousFork:function(){for(var b=this.game.getPosition();C.call(this)&&1==this.node.children.length;);this.change=p(b,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},allowIllegalMoves:function(b){b?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};k.KifuReader=y;var w=function(b,f){this.name=
"InvalidMoveError";this.message="Invalid move in kifu detected. ";if(f.move&&f.move.c!==r&&f.move.x!==r&&f.move.y!==r){var g=f.move.x;7<f.move.x&&g++;String.fromCharCode(g+65);this.message+="Trying to play "+(f.move.c==k.WHITE?"white":"black")+" move on "+String.fromCharCode(f.move.x+65)+""+(19-f.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(b)switch(b){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";
break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};w.prototype=Error();w.prototype.constructor=w;k.InvalidMoveError=w;k.i18n.en.show="show";k.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(k,r){k.SGF={};var t=function(g,k,m,n,b,f){k=f==k?"black":"white";m.info[k]=m.info[k]||{};m.info[k][g]=b[0]},g=k.SGF.properties={};g.B=g.W=function(g,n,m,p){n.move=!m[0]||19>=g.size&&"tt"==m[0]?{pass:!0,c:"B"==p?k.B:k.W}:{x:m[0].charCodeAt(0)-97,y:m[0].charCodeAt(1)-97,c:"B"==p?k.B:k.W}};g.AB=g.AW=function(g,n,m,p){for(var b in m)n.addSetup({x:m[b].charCodeAt(0)-97,y:m[b].charCodeAt(1)-97,c:"AB"==p?k.B:k.W})};g.AE=function(g,k,m){for(var n in m)k.addSetup({x:m[n].charCodeAt(0)-97,y:m[n].charCodeAt(1)-
97})};g.PL=function(g,n,m){n.turn="b"==m[0]||"B"==m[0]?k.B:k.W};g.C=function(g,k,m){k.comment=m.join()};g.LB=function(g,k,m){for(var n in m)k.addMarkup({x:m[n].charCodeAt(0)-97,y:m[n].charCodeAt(1)-97,type:"LB",text:m[n].substr(3)})};g.CR=g.SQ=g.TR=g.SL=g.MA=function(g,k,m,n){for(var b in m)k.addMarkup({x:m[b].charCodeAt(0)-97,y:m[b].charCodeAt(1)-97,type:n})};g.SZ=function(g,k,m){g.size=parseInt(m[0])};g.BR=g.WR=t.bind(this,"rank","BR");g.PB=g.PW=t.bind(this,"name","PB");g.BT=g.WT=t.bind(this,"team",
"BT");g.TM=function(g,k,m,n){g.info[n]=m[0];k.BL=m[0];k.WL=m[0]};var n=/\(|\)|(;(\s*[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+)*)/g,q=/[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+/g,u=/[A-Z]+/,y=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;k.SGF.parse=function(g){var r=[],m,p,b,f=new k.Kifu,s=null;g=g.match(n);for(var t in g)if("("==g[t])r.push(s);else if(")"==g[t])s=r.pop();else{s&&f.nodeCount++;s=s?s.appendChild(new k.KNode):f.root;m=g[t].match(q)||[];f.propertyCount+=m.length;for(var B in m){b=u.exec(m[B])[0];p=
m[B].match(y);for(var w in p)p[w]=p[w].substring(1,p[w].length-1).replace(/\\(?!\\)/g,"");if(k.SGF.properties[b])k.SGF.properties[b](f,s,p,b);else 1>=p.length&&(p=p[0]),s.parent?s[b]=p:f.info[b]=p}}return f}})(WGo);(function(k){var r=function(b,f){this.name="FileError";this.message=1==f?"File '"+b+"' is empty.":2==f?"Network error. It is not possible to read '"+b+"'.":"File '"+b+"' hasn't been found on server."};r.prototype=Error();r.prototype.constructor=r;k.FileError=r;var t=k.loadFromUrl=function(b,f){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4==g.readyState)if(200==g.status){if(0==g.responseText.length)throw new r(b,1);f(g.responseText)}else throw new r(b);};try{g.open("GET",b,!0),g.send()}catch(k){throw new r(b,
2);}},g=function(b){b.change&&this.board.update(b.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var f=[];this.notification();b.node.move&&this.config.markLastMove&&(b.node.move.pass?this.notification(k.t((b.node.move.c==k.B?"b":"w")+"pass")):f.push({type:"CR",x:b.node.move.x,y:b.node.move.y}));if(1<b.node.children.length)for(var g=0;g<b.node.children.length;g++)b.node.children[g].move&&!b.node.children[g].move.pass&&f.push({type:"LB",text:String.fromCharCode(65+g),x:b.node.children[g].move.x,
y:b.node.children[g].move.y,c:"rgba(0,32,128,0.8)"});if(b.node.markup){for(g in b.node.markup)for(var m=0;m<f.length;m++)b.node.markup[g].x==f[m].x&&b.node.markup[g].y==f[m].y&&(f.splice(m,1),m--);f=f.concat(b.node.markup)}this.temp_marks=f;this.board.addObject(f)},n=function(b){this.board.setSize(b.kifu.size);this.board.removeAllObjects();this.config.enableWheel&&this.setWheel(!0)},q=function(b,f){return b==f.element||b==f.element?!1:b._wgo_scrollable||b.scrollHeight>b.offsetHeight?!0:q(b.parentNode,
f)},u=function(b){var f=b.wheelDelta||-1*b.detail;return q(b.target,this)?!0:0>f?(this.next(),this.config.lockScroll&&b.preventDefault&&b.preventDefault(),!this.config.lockScroll):0<f?(this.previous(),this.config.lockScroll&&b.preventDefault&&b.preventDefault(),!this.config.lockScroll):!0},y=function(b){if(document.querySelector(":focus"))return!0;switch(b.keyCode){case 39:this.next();break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&b.preventDefault&&b.preventDefault();
return!this.config.lockScroll},A=function(b,f){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var g in this.kifuReader.node.children)if(this.kifuReader.node.children[g].move&&this.kifuReader.node.children[g].move.x==b&&this.kifuReader.node.children[g].move.y==f){this.next(g);break}},v=function(b){this.config=b;for(var f in v.default)void 0===this.config[f]&&void 0!==v.default[f]&&(this.config[f]=v.default[f]);this.element=b.playerNode||document.createElement("div");this.board=new k.Board(this.element,
this.config.board);this.init();this.initGame()};v.prototype={constructor:v,init:function(){this.kifu=null;this.listeners={kifuLoaded:[n.bind(this)],update:[g.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",this.config.frozen);this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",
A.bind(this));this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(b){this.kifuReader&&this.kifuReader.change&&(b={type:"update",op:b,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,
change:this.kifuReader.change},this.dispatchEvent(b))},loadKifu:function(b,f){this.kifu=b;this.kifuReader=new k.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});this.update("init");f&&this.goTo(f)},loadSgf:function(b,f){try{this.loadKifu(k.Kifu.fromSgf(b),f)}catch(g){this.error(g)}},loadJSON:function(b,f){try{this.loadKifu(k.Kifu.fromJGO(b),f)}catch(g){this.error(g)}},loadSgfFromFile:function(b,f){var g=
this;try{t(b,function(b){g.loadSgf(b,f)})}catch(k){this.error(k)}},addEventListener:function(b,f){this.listeners[b]=this.listeners[b]||[];this.listeners[b].push(f)},removeEventListener:function(b,f){if(this.listeners[b]){var g=this.listeners[b].indexOf(f);-1!=g&&this.listeners[b].splice(g,1)}},dispatchEvent:function(b){if(this.listeners[b.type])for(var f in this.listeners[b.type])this.listeners[b.type][f](b)},notification:function(b){console&&console.log(b)},help:function(b){console&&console.log(b)},
error:function(b){if(!k.ERROR_REPORT)throw b;console&&console.log(b)},next:function(b){if(!this.frozen&&this.kifu)try{this.kifuReader.next(b),this.update()}catch(f){this.error(f)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),this.update()}catch(b){this.error(b)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(b){this.error(b)}},first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(b){this.error(b)}},
goTo:function(b){if(!this.frozen&&this.kifu){var f;"function"==typeof b&&(b=b.call(this));"number"==typeof b?(f=k.clone(this.kifuReader.path),f.m=b||0):f=b;try{this.kifuReader.goTo(f),this.update()}catch(g){this.error(g)}}},getGameInfo:function(){if(!this.kifu)return null;var b={},f;for(f in this.kifu.info)-1!=k.Kifu.infoList.indexOf(f)&&(k.Kifu.infoFormatters[f]?b[k.t(f)]=k.Kifu.infoFormatters[f](this.kifu.info[f]):b[k.t(f)]=k.filterHTML(this.kifu.info[f]));return b},setFrozen:function(b){this.frozen=
b;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(b){b.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(b){document.onkeydown=b?y.bind(this):null},setWheel:function(b){!this._wheel_listener&&b?(this._wheel_listener=u.bind(this),b=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(b,this._wheel_listener)):this._wheel_listener&&!b&&(b=void 0!==document.onmousewheel?
"mousewheel":"DOMMouseScroll",this.element.removeEventListener(b,this._wheel_listener),delete this._wheel_listener)},setCoordinates:function(b){!this.coordinates&&b?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(k.Board.coordinates)):this.coordinates&&!b&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(k.Board.coordinates));this.coordinates=b}};v.default={sgf:void 0,json:void 0,sgfFile:void 0,move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,
kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0};k.Player=v;var m={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},p;for(p in m)k.i18n.en[p]=m[p]})(WGo);
